<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>劇場リスト（タブ式・スマホ最適）</title>
<style>
  :root {
    --bg: #0c0f14;
    --card: #12161d;
    --muted: #8a93a6;
    --text: #e7ebf3;
    --accent: #4f8cff;
    --chip: #1a1f2b;
    --border: #222838;
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body { margin: 0; padding: 16px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "游ゴシック体", "Yu Gothic", "Meiryo", sans-serif; background: var(--bg); color: var(--text); }
  header { display: grid; gap: 10px; margin-bottom: 12px; position: sticky; top: 0; background: rgba(12,15,20,.96); backdrop-filter: blur(6px); z-index: 10; padding-bottom: 8px; }
  h1 { font-size: 20px; margin: 0 0 2px; }
  .tabs { display: flex; gap: 8px; flex-wrap: wrap; }
  .tab { padding: 8px 12px; border-radius: 999px; background: var(--chip); color: var(--text); border: 1px solid var(--border); cursor: pointer; font-size: 14px; }
  .tab .count { opacity: .8; font-size: 12px; margin-left: 6px; }
  .tab.active { background: var(--accent); border-color: var(--accent); color: #fff; }
  .filters { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 6px; }
  .filter-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  @media (min-width: 720px) { .filters { grid-template-columns: 1fr 2fr; align-items: center; } }
  select, input[type="search"] { width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border); background: #0f141d; color: var(--text); }
  .chips { display: flex; gap: 8px; flex-wrap: wrap; }
  .chip { border: 1px solid var(--border); background: var(--chip); border-radius: 999px; padding: 6px 10px; cursor: pointer; font-size: 13px; }
  .chip.active { background: #2a3550; border-color: #2a3550; }
  .group { margin-top: 16px; }
  .group h2 { font-size: 16px; color: var(--muted); font-weight: 600; letter-spacing: .02em; margin: 16px 4px 8px; }
  .grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
  @media (min-width: 540px) { .grid { grid-template-columns: 1fr 1fr; } }
  @media (min-width: 900px) { .grid { grid-template-columns: 1fr 1fr 1fr; } }
  .card { border: 1px solid var(--border); background: var(--card); border-radius: 14px; padding: 12px; display: grid; gap: 8px; }
  .title-row { display: flex; gap: 8px; align-items: center; justify-content: space-between; }
  .title { font-size: 15px; font-weight: 600; line-height: 1.3; }
  .badges { display: flex; gap: 6px; flex-wrap: wrap; }
  .badge { font-size: 12px; padding: 2px 8px; background: #1a2233; border: 1px solid #22304b; border-radius: 999px; }
  .meta { font-size: 13px; color: var(--muted); }
  a.btn { display: inline-block; text-decoration: none; color: #fff; background: var(--accent); padding: 8px 10px; border-radius: 10px; font-size: 13px; text-align: center; }
  .empty { color: var(--muted); font-size: 14px; padding: 16px 4px; }
  footer { margin-top: 18px; color: var(--muted); font-size: 12px; }
  a, button { -webkit-tap-highlight-color: rgba(0,0,0,0); }
</style>
</head>
<body>
<header>
  <h1>劇場リスト（タブ切替・スマホ最適）</h1>
  <div class="tabs" id="tabs">
    <button class="tab active" data-tab="all" type="button">ALL <span class="count" id="count-all"></span></button>
    <button class="tab" data-tab="cinema" type="button">Dolby Cinema 🎥 <span class="count" id="count-cinema"></span></button>
    <button class="tab" data-tab="atmos" type="button">Dolby Atmos 🎬 <span class="count" id="count-atmos"></span></button>
    <button class="tab" data-tab="axk" type="button">Dolby Atmos × 4K 🎬✨ <span class="count" id="count-axk"></span></button>
    <button class="tab" data-tab="ch71" type="button">7.1ch 🔊 <span class="count" id="count-ch71"></span></button>
    <button class="tab" data-tab="k4" type="button">4K ✨ <span class="count" id="count-k4"></span></button>
  </div>
  <div class="filters">
    <div class="filter-row">
      <select id="pref">
        <option value="">都道府県（すべて）</option>
      </select>
      <input id="q" type="search" placeholder="劇場名・住所で検索…" />
    </div>
    <div class="chips">
      <button class="chip" data-chip="hasSeats" type="button">座席数あり</button>
      <button class="chip" data-chip="over200" type="button">座席数200以上</button>
    </div>
  </div>
</header>

<main id="content"></main>

<footer>
  ※ タブ（ALL / Dolby Cinema / Dolby Atmos / Dolby Atmos×4K / 7.1ch / 4K）切替＋都道府県・検索・チップで絞り込みできます。
</footer>

<script>
/* 👇ここにデータを入れる必要があります */
var data = [
  {
    "prefNorm": "東京都",
    "prefDisp": "東京",
    "theater": "新宿シネマサンシャイン",
    "address": "東京都新宿区…",
    "url": "https://example.com",
    "atmos": "3",
    "ch71": "",
    "k4": "1",
    "other": "Dolby Cinema",
    "seats": "142"
  },
  {
    "prefNorm": "大阪府",
    "prefDisp": "大阪",
    "theater": "梅田ブルク7",
    "address": "大阪府大阪市北区…",
    "url": "https://example.com",
    "atmos": "2",
    "ch71": "",
    "k4": "1",
    "other": "",
    "seats": "250"
  }
];
var prefects = [
  {"norm": "東京都", "disp": "東京"},
  {"norm": "大阪府", "disp": "大阪"}
];

/* 以下：描画ロジック（省略なし） */
document.addEventListener('DOMContentLoaded', function() {
  var state = { tab: 'all', pref: '', q: '', chips: {} };
  var elTabs = document.getElementById('tabs');
  elTabs.addEventListener('click', function(e) {
    var t = e.target;
    while (t && t.className.indexOf('tab') === -1) { t = t.parentNode; }
    if (!t) return;
    var tabs = elTabs.getElementsByClassName('tab');
    for (var i=0;i<tabs.length;i++) { tabs[i].className = tabs[i].className.replace(' active',''); }
    if (t.className.indexOf('active') === -1) t.className += ' active';
    state.tab = t.getAttribute('data-tab');
    render();
  }, false);

  var elPref = document.getElementById('pref');
  for (var i=0;i<prefects.length;i++) {
    var opt = document.createElement('option');
    opt.value = prefects[i].norm;
    opt.textContent = prefects[i].disp;
    elPref.appendChild(opt);
  }
  elPref.addEventListener('change', function(e) {
    state.pref = e.target.value;
    render();
  }, false);

  var q = document.getElementById('q');
  q.addEventListener('input', function(e) {
    state.q = e.target.value.replace(/^\s+|\s+$/g, '');
    render();
  }, false);

  var chips = document.getElementsByClassName('chip');
  for (var i=0;i<chips.length;i++) {
    chips[i].addEventListener('click', function() {
      var key = this.getAttribute('data-chip');
      state.chips[key] = !state.chips[key];
      if (state.chips[key]) this.className += ' active'; else this.className = this.className.replace(' active','');
      render();
    }, false);
  }

  function includes(hay, needle) { return hay.indexOf(needle) !== -1; }
  function trim(s) { return String(s||'').replace(/^\s+|\s+$/g, ''); }

  function matchesTab(rec) {
    if (state.tab === 'all') return true;
    if (state.tab === 'cinema') return rec.other && includes(rec.other, 'Dolby Cinema');
    if (state.tab === 'atmos') return rec.atmos && trim(rec.atmos) !== '';
    if (state.tab === 'axk') return rec.atmos && trim(rec.atmos) !== '' && rec.k4 && trim(rec.k4) !== '';
    if (state.tab === 'ch71') return rec.ch71 && trim(rec.ch71) !== '';
    if (state.tab === 'k4') return rec.k4 && trim(rec.k4) !== '';
    return true;
  }

  function matchesFilters(rec) {
    if (state.pref && rec.prefNorm !== state.pref) return false;
    if (state.q) {
      var hay = (rec.theater + ' ' + rec.address + ' ' + (rec.prefDisp||'')).toLowerCase();
      if (hay.indexOf(state.q.toLowerCase()) === -1) return false;
    }
    if (state.chips['hasSeats']) {
      if (!rec.seats || trim(rec.seats) === '' || rec.seats === '—') return false;
    }
    if (state.chips['over200']) {
      var n = parseInt(String(rec.seats||'').replace(/[^0-9]/g,''), 10) || 0;
      if (n < 200) return false;
    }
    return true;
  }

  function groupByPref(recs) {
    var map = {};
    for (var i=0;i<recs.length;i++) {
      var k = recs[i].prefNorm || '（都道府県不明）';
      if (!map[k]) map[k] = [];
      map[k].push(recs[i]);
    }
    return map;
  }

  function badgeRow(rec) {
    var badges = [];
    if (rec.atmos && trim(rec.atmos) !== '') badges.push('🎬 Dolby Atmos：' + rec.atmos);
    if (rec.k4 && trim(rec.k4) !== '') badges.push('✨ 4K：' + rec.k4);
    if (rec.other && includes(rec.other, 'Dolby Cinema')) badges.push('🎥 Dolby Cinema');
    if (!badges.length) return '';
    var html = '<div class="badges">';
    for (var i=0;i<badges.length;i++) html += '<span class="badge">' + badges[i] + '</span>';
    html += '</div>';
    return html;
  }

  function seatsLine(rec) {
    var s = (rec.seats && trim(rec.seats) !== '') ? rec.seats : '—';
    if (rec.atmos && trim(rec.atmos) !== '' && s !== '—') {
      return '🎬 Dolby Atmos：' + rec.atmos + '（💺 座席数：' + s + '）';
    }
    return '💺 座席数：' + s;
  }

  function card(rec) {
    var link = rec.url ? '<a class="btn" href="' + rec.url + '" target="_blank" rel="noopener">公式サイト</a>' : '';
    var html = '<div class="card">'
      + '<div class="title-row">'
      +   '<div class="title">' + rec.theater + '</div>'
      +   (badgeRow(rec) || '')
      + '</div>'
      + '<div class="meta">📍 ' + rec.address + '</div>'
      + '<div class="meta">' + seatsLine(rec) + '</div>'
      + link
      + '</div>';
    return html;
  }

  function counts() {
    var cc = { all: 0, cinema: 0, atmos: 0, axk: 0, ch71: 0, k4: 0 };
    for (var i=0;i<data.length;i++) {
      var r = data[i];
      cc.all++;
      if (r.other && includes(r.other, 'Dolby Cinema')) cc.cinema++;
      if (r.atmos && trim(r.atmos) !== '') cc.atmos++;
      if (r.atmos && trim(r.atmos) !== '' && r.k4 && trim(r.k4) !== '') cc.axk++;
      if (r.ch71 && trim(r.ch71) !== '') cc.ch71++;
      if (r.k4 && trim(r.k4) !== '') cc.k4++;
    }
    var ids = ['all','cinema','atmos','axk','ch71','k4'];
    for (var j=0;j<ids.length;j++) {
      var el = document.getElementById('count-' + ids[j]);
      if (el) el.textContent = '(' + cc[ids[j]] + ')';
    }
  }

  function render() {
    counts();
    var recs = [];
    for (var i=0;i<data.length;i++) {
      if (matchesTab(data[i]) && matchesFilters(data[i])) recs.push(data[i]);
    }
    var groups = groupByPref(recs);
    var content = document.getElementById('content');
    var html = '';
    for (var i=0;i<prefects.length;i++) {
      var key = prefects[i].norm;
      var arr = groups[key];
      if (!arr || !arr.length) continue;
      html += '<section class="group"><h2>' + prefects[i].disp + '</h2><div class="grid">';
      for (var k=0;k<arr.length;k++) html += card(arr[k]);
      html += '</div></section>';
    }
    if (!html) html = '<div class="empty">該当する劇場がありません。フィルター条件を変更してください。</div>';
    content.innerHTML = html;
  }

  render();
});
</script>
</body>
</html>
