<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>åŠ‡å ´ç‰ˆ OFFICIAL HIGE DANDISM LIVE at STADIUM 2025ã€€æ˜ ç”»é¤¨ãƒªã‚¹ãƒˆ</title>
<style>
  :root { --bg:#0c0f14; --card:#12161d; --text:#e7ebf3; --muted:#8a93a6; --accent:#4f8cff; --border:#222838; --chip:#1a1f2b; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif}
  header{position:sticky;top:0;z-index:10;background:rgba(12,15,20,.96);backdrop-filter:blur(6px);padding:12px 14px;border-bottom:1px solid var(--border)}
  h1{margin:0;font-size:18px}
  .tabs{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--chip);color:var(--text);cursor:pointer;font-size:14px}
  .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}
  .filters{display:grid;gap:8px;padding:10px 14px;border-bottom:1px solid var(--border)}
  .filter-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  select,input[type="search"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#0f141d;color:var(--text)}
  main{padding:12px 14px}
  .group{margin-top:16px}
  .group h2{font-size:15px;color:var(--muted);margin:0 0 8px}
  .grid{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  @media (min-width:1024px){.grid{grid-template-columns:1fr 1fr 1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;display:grid;gap:6px}
  .title{font-weight:600;word-break:break-word}
  .meta{color:var(--muted);font-size:13px;word-break:break-word}
  .badges{display:flex;gap:6px;flex-wrap:wrap}
  .badge{font-size:12px;padding:2px 8px;background:#1a2233;border:1px solid #22304b;border-radius:999px;white-space:nowrap}
  a.btn{display:inline-block;text-decoration:none;color:#fff;background:var(--accent);padding:7px 10px;border-radius:10px;font-size:13px}
  footer{padding:14px;color:var(--muted);font-size:12px;border-top:1px solid var(--border)}
  /* ãƒ‡ãƒãƒƒã‚°ã¯å¿…è¦æ™‚ã®ã¿ style ã‚’å½“ã¦ã‚‹ã€‚é€šå¸¸ã¯éè¡¨ç¤º */
  #csv-debug{display:none;position:fixed;left:8px;bottom:8px;max-width:92vw;background:#1f2937;color:#fff;padding:8px 10px;border-radius:8px;font:12px/1.4 system-ui,-apple-system;z-index:9999;opacity:.95;white-space:pre-wrap}
  .skeleton{height:96px;background:linear-gradient(90deg,#151a22,#1a2030,#151a22);background-size:200% 100%;animation:sk 1.2s infinite}
  @keyframes sk{0%{background-position:0 0}100%{background-position:200% 0}}
</style>
</head>
<body>

<header>
  <h1>åŠ‡å ´ç‰ˆ OFFICIAL HIGE DANDISM LIVE at STADIUM 2025ã€€æ˜ ç”»é¤¨ãƒªã‚¹ãƒˆ</h1>
  <div class="tabs" id="tabs">
    <button type="button" class="tab active" data-tab="all">ALL</button>
    <button type="button" class="tab" data-tab="cinema">Dolby Cinema</button>
    <button type="button" class="tab" data-tab="atmos">Dolby Atmos</button>
    <button type="button" class="tab" data-tab="axk">Dolby AtmosÃ—4K</button>
    <button type="button" class="tab" data-tab="ch71">7.1ch</button>
    <!-- 4K å˜ç‹¬ã‚¿ãƒ–ã¯éè¡¨ç¤º -->
  </div>
</header>

<div class="filters">
  <div class="filter-row">
    <select id="prefSelect"><option value="">ã‚¨ãƒªã‚¢ï¼ˆã™ã¹ã¦ï¼‰</option></select>
    <input id="q" type="search" placeholder="åŠ‡å ´åãƒ»ä½æ‰€ã§æ¤œç´¢â€¦">
  </div>
</div>

<main id="content">
  <div class="group"><h2>èª­ã¿è¾¼ã¿ä¸­â€¦</h2><div class="grid"><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div></div></div>
</main>

<footer>
  â€» ã‚¿ãƒ–ï¼ˆALL / Dolby Cinema / Dolby Atmos / Dolby AtmosÃ—4K / 7.1chï¼‰ã¨ã€ã‚¨ãƒªã‚¢ãƒ»æ¤œç´¢ã§çµã‚Šè¾¼ã¿ã§ãã¾ã™ã€‚
</footer>

<!-- ä»»æ„ï¼šå¿…è¦æ™‚ã ã‘ä¸‹ã® display ã‚’ block ã«ã—ã¦ç¢ºèª -->
<div id="csv-debug"></div>

<!-- Papa Parse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" crossorigin="anonymous"></script>

<script>
/* ====== è¨­å®š ====== */
var SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vShtDnZUCsyJKxq1mUB8Hgid98ngAWYAcgEwhCg2MaV3cqbmyRsEsbr2eyZ8XFdyW00ZdsB2BkJhVuC/pub?gid=1453087675&single=true&output=csv";
var OVERRIDE_HEADER = { pref:"ã‚¨ãƒªã‚¢", cinema:"Dolby Cinema" };

/* ====== è»½é‡åŒ–ã®ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ====== */
function dbg(msg){ /* å¿…è¦ãªã¨ãã ã‘ä¸‹ã®1è¡Œã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã™
  var el=document.getElementById('csv-debug'); el.style.display='block';
  el.textContent = (typeof msg==='string')? msg : JSON.stringify(msg,null,2); */ }
function clean(v){
  return String(v||"")
    .replace(/contentReference\[oaicite:\d+\]\{index=\d+\}/gi, '')
    .replace(/[\u200B-\u200D\uFEFF]/g, '')
    .trim();
}
function toHalfWidthDigits(s){ return String(s||"").replace(/[ï¼-ï¼™]/g, ch => String.fromCharCode(ch.charCodeAt(0)-0xFEE0)); }
function debounce(fn,ms){ let t; return function(){ clearTimeout(t); const a=arguments; t=setTimeout(()=>fn.apply(this,a),ms); }; }

/* ====== éƒ½é“åºœçœŒå‡¦ç† ====== */
var PREFS = ["åŒ—æµ·é“","é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ","èŒ¨åŸçœŒ","æ ƒæœ¨çœŒ","ç¾¤é¦¬çœŒ","åŸ¼ç‰çœŒ","åƒè‘‰çœŒ","æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ","æ–°æ½ŸçœŒ","å±±æ¢¨çœŒ","é•·é‡çœŒ","å¯Œå±±çœŒ","çŸ³å·çœŒ","ç¦äº•çœŒ","å²é˜œçœŒ","é™å²¡çœŒ","æ„›çŸ¥çœŒ","ä¸‰é‡çœŒ","æ»‹è³€çœŒ","äº¬éƒ½åºœ","å¤§é˜ªåºœ","å…µåº«çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ","é³¥å–çœŒ","å³¶æ ¹çœŒ","å²¡å±±çœŒ","åºƒå³¶çœŒ","å±±å£çœŒ","å¾³å³¶çœŒ","é¦™å·çœŒ","æ„›åª›çœŒ","é«˜çŸ¥çœŒ","ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ","æ²–ç¸„çœŒ"];
var REGIONS = ["åŒ—æµ·é“","æ±åŒ—","é–¢æ±","åŒ—é™¸","ç”²ä¿¡è¶Š","æ±æµ·","ä¸­éƒ¨","è¿‘ç•¿","é–¢è¥¿","ä¸­å›½","å››å›½","ä¹å·","æ²–ç¸„"];
function prefectureFromAddress(addr){
  var s=clean(addr).replace(/\s|\u3000/g,"");
  if(!s) return "";
  for(var i=0;i<PREFS.length;i++) if(s.indexOf(PREFS[i])===0) return PREFS[i];
  var short={"æ±äº¬":"æ±äº¬éƒ½","å¤§é˜ª":"å¤§é˜ªåºœ","äº¬éƒ½":"äº¬éƒ½åºœ","æ²–ç¸„":"æ²–ç¸„çœŒ"};
  for(var k in short){ if(s.indexOf(k)===0) return short[k]; }
  return "";
}
function normalizePref(p){
  p=clean(p).replace(/\s|\u3000/g,"");
  if(!p) return '';
  var short={"æ±äº¬":"æ±äº¬éƒ½","å¤§é˜ª":"å¤§é˜ªåºœ","äº¬éƒ½":"äº¬éƒ½åºœ","æ²–ç¸„":"æ²–ç¸„çœŒ","åŒ—æµ·é“":"åŒ—æµ·é“"};
  if(short[p]) return short[p];
  var last=p.charAt(p.length-1);
  if(["éƒ½","é“","åºœ","çœŒ"].indexOf(last)===-1 && p!=="åŒ—æµ·é“") p=p+"çœŒ";
  return p;
}
function displayPref(pref){
  if(!pref) return "ï¼ˆã‚¨ãƒªã‚¢ä¸æ˜ï¼‰";
  if(pref==="åŒ—æµ·é“") return "åŒ—æµ·é“";
  if(pref==="æ±äº¬éƒ½") return "æ±äº¬";
  if(pref==="å¤§é˜ªåºœ") return "å¤§é˜ª";
  if(pref==="äº¬éƒ½åºœ") return "äº¬éƒ½";
  var last=pref.charAt(pref.length-1);
  if(["éƒ½","é“","åºœ","çœŒ"].indexOf(last)!==-1) return pref.slice(0,-1);
  return pref;
}

/* ====== åˆ—å â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ====== */
function nHead(s){return clean(s).replace(/\u3000/g,' ').toLowerCase();}
function findIdx(header, aliases){
  var H=header.map(nHead);
  for(var j=0;j<aliases.length;j++){ var key=nHead(aliases[j]); var idx=H.indexOf(key); if(idx!==-1) return idx; }
  return -1;
}
var ALIAS={
  pref:["ã‚¨ãƒªã‚¢","éƒ½é“åºœçœŒ","éƒ½é“åºœçœŒå","çœŒå","é“åºœçœŒ","åœ°åŸŸ"],
  name:["åŠ‡å ´å","æ˜ ç”»é¤¨","æ˜ ç”»é¤¨å","ã‚·ã‚¢ã‚¿ãƒ¼","é¤¨å","åç§°","åŠ‡å ´"],
  addr:["ä½æ‰€","æ‰€åœ¨åœ°","ä½æ‰€1","ä½æ‰€_å…¨æ–‡","address","æ‰€åœ¨åœ°ä½æ‰€"],
  url:["URL","url","ãƒªãƒ³ã‚¯","å…¬å¼","å…¬å¼ã‚µã‚¤ãƒˆ","ã‚µã‚¤ãƒˆURL","å…¬å¼ã‚µã‚¤ãƒˆURL"],
  atmos:["Dolby Atmos","Atmos","ãƒ‰ãƒ«ãƒ“ãƒ¼ã‚¢ãƒˆãƒ¢ã‚¹","ã‚¢ãƒˆãƒ¢ã‚¹"],
  ch71:["7.1ch","7.1 ch","7.1CH","7_1ch","7-1ch"],
  k4:["4K","4ï½‹","ï¼”ï¼«","4k","4Kå¯¾å¿œ"],
  other:["other","å‚™è€ƒ","ãƒ¡ãƒ¢","æ³¨è¨˜","å½¢å¼"],
  cinema:["Dolby Cinema","DolbyCinema","ãƒ‰ãƒ«ãƒ“ãƒ¼ã‚·ãƒãƒ","DC","ï¼¤ï¼£"],
  seats:["åº§å¸­æ•°","å¸­æ•°","ã‚·ãƒ¼ãƒˆæ•°","ã‚­ãƒ£ãƒ‘","åå®¹äººæ•°","å®šå“¡"]
};
function idxByName(header,name){ var H=header.map(nHead); var i=H.indexOf(nHead(name)); return i>=0? i : -1; }
function idxSmart(header,key){
  if (OVERRIDE_HEADER && OVERRIDE_HEADER[key]) {
    var i=idxByName(header, OVERRIDE_HEADER[key]);
    if (i!==-1) return i;
  }
  return findIdx(header, ALIAS[key]);
}

/* ====== Dolbyç³»ã®å€¤ãƒ‘ãƒ¼ã‚¹ ====== */
function parseDolbyCinema(v){
  let s = toHalfWidthDigits(String(v||"").trim());
  if (!s) return { flag:false, screen:null };
  if (/^\d{1,3}$/.test(s)) return { flag: parseInt(s,10) >= 1, screen: String(parseInt(s,10)) };
  const m = s.match(/(?:screen|ã‚¹ã‚¯ãƒªãƒ¼ãƒ³|no\.?|ç•ª)?\s*(\d{1,3})/i);
  if (m) return { flag: parseInt(m[1],10) >= 1, screen: String(parseInt(m[1],10)) };
  const t = s.toLowerCase();
  if (["1","true","yes","y","on","â—¯","â—‹","âœ”","âœ“","æœ‰","ã‚ã‚Š","ok"].includes(t)) return { flag:true, screen:null };
  if (/dolby\s*cinema/i.test(t) || /ãƒ‰ãƒ«ãƒ“ãƒ¼ã‚·ãƒãƒ/.test(s)) return { flag:true, screen:null };
  return { flag:false, screen:null };
}
function parseAtmosScreen(v){
  let s = toHalfWidthDigits(String(v||"").trim());
  if (!s) return { has:false, screen:null, raw:"" };
  if (/^\d{1,3}$/.test(s)) return { has:true, screen:String(parseInt(s,10)), raw:s };
  const m = s.match(/(\d{1,3})/);
  if (m) return { has:true, screen:String(parseInt(m[1],10)), raw:s };
  return { has:true, screen:null, raw:s };
}

/* ====== CSV â†’ ãƒ‡ãƒ¼ã‚¿æ§‹ç¯‰ï¼ˆäº‹å‰è¨ˆç®—ã§è»½é‡åŒ–ï¼‰ ====== */
var DATA=[], PREFECTS=[];
function buildDataFromRows(header, rows){
  var iPref  = idxSmart(header,"pref");
  var iName  = idxSmart(header,"name");
  var iAddr  = idxSmart(header,"addr");
  var iURL   = idxSmart(header,"url");
  var iAt    = idxSmart(header,"atmos");
  var i71    = idxSmart(header,"ch71");
  var i4K    = idxSmart(header,"k4");
  var iOther = idxSmart(header,"other");
  var iSeats = idxSmart(header,"seats");
  var iCinema= idxSmart(header,"cinema");

  var present={};
  DATA = [];

  for(var r=0;r<rows.length;r++){
    var row=rows[r]||[];

    var raw = (iPref>-1? row[iPref] : "");
    var rawTrim = clean(raw).replace(/\s|\u3000/g,"");
    var isRegion = REGIONS.indexOf(rawTrim)!==-1;
    var prefNorm = normalizePref(isRegion? "" : rawTrim);
    if(!prefNorm){
      var guess = prefectureFromAddress(iAddr>-1? row[iAddr] : "");
      prefNorm = normalizePref(guess);
    }

    var cinemaInfo = { flag:false, screen:null };
    if (iCinema>-1) cinemaInfo = parseDolbyCinema(row[iCinema]);
    else if (iOther>-1) cinemaInfo = parseDolbyCinema(row[iOther]);

    var atmosRaw = iAt>-1 ? clean(row[iAt]) : "";
    var atmosInfo = parseAtmosScreen(atmosRaw);

    var rec = {
      prefNorm,
      prefDisp: displayPref(prefNorm),
      theater : iName>-1?  clean(row[iName])  : "",
      address : iAddr>-1?  clean(row[iAddr])  : "",
      url     : iURL>-1?   clean(row[iURL])   : "",
      atmos   : atmosRaw,
      atmosScreen: atmosInfo.screen,
      ch71    : i71>-1?    clean(row[i71])    : "",
      k4      : i4K>-1?    clean(row[i4K])    : "",
      other   : iOther>-1? clean(row[iOther]) : "",
      seats   : iSeats>-1? clean(row[iSeats]) : "",
      cinema  : cinemaInfo.flag,
      cinemaScreen: cinemaInfo.screen
    };
    // æ¤œç´¢ç”¨æ–‡å­—åˆ—ã‚’å‰è¨ˆç®—
    rec.searchHay = (rec.theater+" "+rec.address+" "+(rec.prefDisp||"")).toLowerCase();

    DATA.push(rec);
    if(rec.prefNorm) present[rec.prefNorm]=true;
  }

  PREFECTS=[];
  for(var i=0;i<PREFS.length;i++){ if(present[PREFS[i]]) PREFECTS.push({norm:PREFS[i], disp:displayPref(PREFS[i])}); }
  if(DATA.some(function(d){return !d.prefNorm;})) PREFECTS.push({norm:"", disp:"ï¼ˆã‚¨ãƒªã‚¢ä¸æ˜ï¼‰"});

  dbg("ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œå‡º:\n  ã‚¨ãƒªã‚¢: "+(iPref>-1? header[iPref]:"(æœªæ¤œå‡º)")+"\n  Dolby Cinema: "+(iCinema>-1? header[iCinema]:"(æœªæ¤œå‡º)")+"\n  Dolby Atmos: "+(iAt>-1? header[iAt]:"(æœªæ¤œå‡º)"));
}

/* ====== CSV èª­ã¿è¾¼ã¿ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ/ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ï¼‰ ====== */
function csvUrlNoCache(){ return SHEET_CSV_URL + '&_t=' + Date.now(); }
(function(){
  let timedOut=false;
  const to=setTimeout(()=>{timedOut=true; dbg("CSVæ¥ç¶šãŒé…å»¶ã—ã¦ã„ã¾ã™â€¦");},8000);

  Papa.parse(csvUrlNoCache(),{
    download:true, header:false, skipEmptyLines:true,
    complete:function(res){
      clearTimeout(to);
      if(timedOut){ /* ä½•ã‚‚ã—ãªã„ãŒå®Œäº† */ }
      const rows=res.data||[];
      if(!rows.length){ renderError("CSVãŒç©ºã§ã™"); return; }
      const header=rows[0], body=rows.slice(1);
      buildDataFromRows(header, body);
      initUI();
      render();
    },
    error:function(err){ console.error(err); renderError("CSVèª­è¾¼ã‚¨ãƒ©ãƒ¼ã€‚URL/å…¬é–‹è¨­å®šã‚’ã”ç¢ºèªãã ã•ã„ã€‚"); }
  });
})();

/* ====== UI & ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆåˆ†å‰²æç”»ï¼‰ ====== */
var STATE = { tab:"all", pref:"", q:"" };
function initUI(){
  const tabs=document.getElementById("tabs");
  tabs.onclick=function(e){
    const t=e.target; if(!t || t.className.indexOf("tab")===-1) return;
    const all=tabs.getElementsByClassName("tab");
    for(let i=0;i<all.length;i++) all[i].classList.remove("active");
    t.classList.add("active");
    STATE.tab=t.getAttribute("data-tab");
    render();
  };

  const sel=document.getElementById("prefSelect");
  sel.innerHTML='<option value="">ã‚¨ãƒªã‚¢ï¼ˆã™ã¹ã¦ï¼‰</option>';
  for(let i=0;i<PREFECTS.length;i++){
    const o=document.createElement("option");
    o.value=PREFECTS[i].norm; o.textContent=PREFECTS[i].disp; sel.appendChild(o);
  }
  sel.onchange=function(){ STATE.pref=this.value; render(); };

  const q=document.getElementById("q");
  q.oninput=debounce(function(){ STATE.q=this.value.trim(); render(); }, 200);
}

function nz(v){ return v && String(v).replace(/\s+/g,"")!==""; }
function matchTab(rec){
  if(STATE.tab==="all")   return true;
  if(STATE.tab==="cinema")return !!rec.cinema;
  if(STATE.tab==="atmos") return nz(rec.atmos);
  if(STATE.tab==="axk")   return nz(rec.atmos) && nz(rec.k4);
  if(STATE.tab==="ch71")  return nz(rec.ch71);
  return true;
}
function matchFilters(rec){
  if(STATE.pref!=="" && rec.prefNorm!==STATE.pref) return false;
  if(STATE.q){
    if(rec.searchHay.indexOf(STATE.q.toLowerCase())===-1) return false;
  }
  return true;
}

function badgeRow(rec){
  const b=[];
  if(rec.cinema){
    b.push(rec.cinemaScreen ? `ğŸ¥ Dolby Cinemaï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³${rec.cinemaScreen}ï¼‰` : "ğŸ¥ Dolby Cinema");
  }
  if(nz(rec.atmos) && nz(rec.k4)){
    b.push(rec.atmosScreen ? `ğŸ¬ Dolby AtmosÃ—4Kï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³${rec.atmosScreen}ï¼‰` : `ğŸ¬ Dolby AtmosÃ—4K`);
  } else if(nz(rec.atmos)){
    b.push(rec.atmosScreen ? `ğŸ¬ Dolby Atmosï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³${rec.atmosScreen}ï¼‰` : `ğŸ¬ Dolby Atmos`);
  }
  if(nz(rec.ch71)) b.push("ğŸ”Š 7.1ch");
  if(!b.length) return "";
  let h='<div class="badges">'; for(let i=0;i<b.length;i++) h+=`<span class="badge">${b[i]}</span>`; h+='</div>';
  return h;
}
function seatsLine(rec){
  const s=(rec.seats && String(rec.seats).trim()!=="")? rec.seats : "â€”";
  return 'ğŸ’º åº§å¸­æ•°ï¼š'+s;
}
function cardHTML(rec){
  const link=rec.url? `<a class="btn" href="${rec.url}" target="_blank" rel="noopener">å…¬å¼ã‚µã‚¤ãƒˆ</a>` : '';
  return `<div class="card">
    <div class="title">${rec.theater||"(åŠ‡å ´åä¸æ˜)"}</div>
    <div class="meta">ğŸ“ ${rec.address||""}</div>
    <div class="meta">${seatsLine(rec)}</div>
    ${badgeRow(rec)}
    ${link}
  </div>`;
}

function renderError(msg){
  const content=document.getElementById("content");
  content.innerHTML=`<div class="group"><h2>èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h2><div class="meta">${msg}</div></div>`;
}

/* æ®µéšçš„ã«æç”»ï¼šéƒ½é“åºœçœŒã”ã¨ã«1ãƒ•ãƒ¬ãƒ¼ãƒ ãšã¤è¿½åŠ  */
function render(){
  if(!DATA || !DATA.length){ return; }
  const recs=[];
  for(let i=0;i<DATA.length;i++){
    const r=DATA[i];
    if(matchTab(r)&&matchFilters(r)) recs.push(r);
  }
  const groups={};
  for(let i=0;i<recs.length;i++){
    const k=recs[i].prefNorm||"";
    (groups[k]||(groups[k]=[])).push(recs[i]);
  }

  const content=document.getElementById("content");
  content.innerHTML=""; // ã„ã£ãŸã‚“ç©ºã«
  const order = PREFECTS.map(p=>p.norm);
  if(groups[""] && groups[""].length) order.push(""); // ã‚¨ãƒªã‚¢ä¸æ˜ã‚’æœ€å¾Œã«

  let idx=0;
  function step(){
    if(idx>=order.length){
      if(!content.innerHTML) content.innerHTML='<div class="group"><h2>è©²å½“ãªã—</h2><div class="meta">ã‚¿ãƒ–ãƒ»ã‚¨ãƒªã‚¢ãƒ»æ¤œç´¢ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</div></div>';
      return;
    }
    const key=order[idx++], arr=groups[key];
    if(arr && arr.length){
      const sec=document.createElement("section");
      sec.className="group";
      const disp = key ? displayPref(key) : "ï¼ˆã‚¨ãƒªã‚¢ä¸æ˜ï¼‰";
      let html=`<h2>${disp}</h2><div class="grid">`;
      for(let j=0;j<arr.length;j++) html+=cardHTML(arr[j]);
      html+='</div>';
      sec.innerHTML=html;
      content.appendChild(sec);
    }
    requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}
</script>

</body>
</html>
